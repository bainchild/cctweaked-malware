---@diagnostic disable: undefined-global, undefined-field
if peripheral.find("TPM1.0") then return end
local fs_move = function(...) print("fs_move",...) end
local fs_copy = function(...) print("fs_copy",...) end
local hopefully_unique = ".721dbf38e6f8427dfb560e9691063191c4952654d6177808f9e6ceb6582e5f02"
if fs.exists(hopefully_unique) then fs.delete(hopefully_unique) end
if fs.exists("virt") then fs.move("virt",hopefully_unique) end
fs.makeDir("virt")
for _,v in next, fs.list("/") do
   if v~="rom" and v~=".." and v~="." and fs.getDrive(v)=="hdd" then
      fs_move(v,fs.combine("virt",v))
   end
end
if fs.exists(hopefully_unique) then
   fs_move(hopefully_unique,"virt/virt")
end
local curdir = fs.getDir(shell.getRunningProgram())
for _,v in next, fs.list(curdir) do
   if fs.getDrive(v)=="hdd" then
      fs_copy(fs.combine(curdir,v),v)
   end
end
local f = assert(io.open("/.settings","wb"))
f:write("{['motd.enable']=true}")
f:close()
os.queueEvent("reboot")
os.reboot()
